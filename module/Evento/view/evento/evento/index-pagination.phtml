<link rel="stylesheet"
	href="/assets/compact-css/jquery.tablesorter.theme.bootstrap.css,jquery.tablesorter.pager.css">

<?php
  /** @var $form \Evento\Form\Evento */
  /** @var $lista \Evento\Service\Evento[] */
?>
<style>
.vertical .carousel-inner {
	height: 330px;
}

#myCarousel {
	width: 500px;
}

.row-fluid {
	width: 530px;
}

#conteudo-carrossel {
	width: 530px;
}

.carousel-inner {
	overflow: hidden;
	position: relative;
	width: 530px;
}

.carousel.vertical .item {
	-webkit-transition: 0.6s ease-in-out top;
	-moz-transition: 0.6s ease-in-out top;
	-ms-transition: 0.6s ease-in-out top;
	-o-transition: 0.6s ease-in-out top;
	transition: 0.6s ease-in-out top;
}

.carousel.vertical .active {
	top: 0;
}

.carousel.vertical .next {
	top: 400px;
}

.carousel.vertical .prev {
	top: -400px;
}

.carousel.vertical .next.left, .carousel.vertical .prev.right {
	top: 0;
}

.carousel.vertical .active.left {
	top: -400px;
}

.carousel.vertical .active.right {
	top: 400px;
}

.carousel.vertical .item {
	left: 0;
}

.carousel-control {
	background: #222222 none repeat scroll 0 0;
	border: 3px solid #ffffff;
	border-radius: 23px;
	color: #ffffff;
	font-size: 60px;
	font-weight: 100;
	height: 40px;
	left: 15px;
	line-height: 30px;
	margin-top: -20px;
	opacity: 0.5;
	position: absolute;
	text-align: center;
	top: 40%;
	width: 40px;
}
</style>

<div class="col-md-12">
	<div class="table-responsive block-flat">
		<div class="content">
			<table class="table table-striped table-bordered dataTable" id="tablesorterEventos">
				<thead>
					<tr>
						<th class="text-center">Evento</th>
						<th class="text-center">Cidade (UF)</th>
						<th class="text-center">Tipo de Regra</th>
						<th class="text-center">Data</th>
						<th class="text-center">Colorida(R$)</th>
						<th class="text-center">Faixa Preta(R$)</th>
						<th class="text-center">A√ß√µes</th>
					</tr>
				</thead>
				<tfoot>
                     <tr>
						<th class="text-center">Evento</th>
						<th class="text-center">Cidade (UF)</th>
						<th class="text-center">Tipo de Regra</th>
						<th class="text-center">Data</th>
						<th class="text-center">Colorida(R$)</th>
						<th class="text-center">Faixa Preta(R$)</th>
						<th class="text-center">A√ß√µes</th>
					</tr>
					<tr>
	                    <th colspan="7" class="ts-pager form-horizontal">
	                        <?php
	                        echo $this->paginationControl(
	                                $paginator, 'Sliding', 'partials/pagination.phtml', [
	                            'urlPagination' => '/evento-evento/index-pagination',
	                            'countPerPage' => $countPerPage,
	                            'divData' => '#evento-pagination',
	                                ]
	                        );
	                        ?>  
	                    </th>
	                </tr>
                 </tfoot>
                <?php
		        $numeroLinha = (($paginator->getCurrentPageNumber() - 1) * $paginator->getItemCountPerPage());
		        if (!empty($paginator)) {
                	?>
					<tbody>
						<tr role="row" class="tablesorter-filter-row">
	                        <?php foreach ($camposFilter as $key => $campoFilter) { ?>    
	                            <td>
	                                <?php
	                                if (!is_null($campoFilter)) {
	                                    ?>
	                                    <input type="search" placeholder="" class="tablesorter-filter" data-column="<?= $key ?>" value="<?= isset($filter[$key]) ? $filter[$key] : '' ?>">
	                                    <?php
	                                } else {
	                                    ?>
	                                    &nbsp;                                        
	                                    <?php
	                                }
	                                ?>
	                            </td>
	                        <?php } ?>                            
	                    </tr>
	                    <?php $arrayRegrasPreenchidas = array(); ?>
						<?php $regraLutaService = new \RegrasLutas\Service\RegrasLutasService(); ?>
                        <?php foreach($paginator as $key => $item){ ?>
                        	<?php $arRegraLuta = $regraLutaService->getRegrasLutasToArray($item['id_regra_luta']); ?>
                            <?php $arrayRegrasPreenchidas[] =  $arRegraLuta['id_regra_luta'];?>
	                        <tr>
								<td class="text-center"><?= $item['nm_evento']?></td>
								<td class="text-center"><?= $item['nm_cidade'] . ' (' . $item['sg_estado'] . ')' ?></td>
								<td class="text-center"><a href="#" data-toggle="modal" data-target="#myModalRegras">
		                                        <?= $item['nm_regra_luta']?>
		                        </a></td>
		
								<td class="text-center"><?= Estrutura\Helpers\Data::converterDataBancoMySQL2Brazil($item['dt_evento'])?></td>
								<td class="text-center">R$ <?= $item['vl_inscricao_colorida']?></td>
								<td class="text-center">R$ <?= $item['vl_inscricao_preta']?></td>
		
								<td class="text-center" style="width: 200px;">
		                               <?= \Estrutura\Service\HtmlHelper::botaoAlterarCustomizado($this->url('navegacao',array('controller'=>$controller,'action'=>'realizarinscricoes','id'=>Estrutura\Helpers\Cript::enc($item['id_evento']))),'Realizar Inscri√ß√µes')?>
		                               <?= \Estrutura\Service\HtmlHelper::botaoAlterar($this->url('navegacao',array('controller'=>$controller,'action'=>'cadastro','id'=>Estrutura\Helpers\Cript::enc($item['id_evento']))))?>
		                               <?= \Estrutura\Service\HtmlHelper::botaoExcluir($this->url('navegacao',array('controller'=>$controller,'action'=>'excluir','id'=>Estrutura\Helpers\Cript::enc($item['id_evento']))))?>
		                        </td>
							</tr>
						<?php } ?>
	                </tbody>
                <?php } ?>
            </table>
			<div class="row">
				<div class="col-md-12">
					<a	href="<?=$this->url('navegacao', ['controller'=>'principal-principal'])?>"
						class="btn btn-primary" title="Retorna para a P√°gina Principal">Home</a>
					<a class="btn btn-default"
						href="<?=$this->url('navegacao',array('controller'=>$controller,'action'=>'cadastro'))?>"
						title="Inserir nova Competi√ß√£o">Nova Competi√ß√£o</a>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal -->
<!-- Apresenta todas os tipos de regras da p·gina atual -->
<div class="modal fade" id="myModalRegras" tabindex="-1" role="dialog"
	aria-labelledby="myModalRegrasLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalRegrasLabel">Configura√ßao da
					Regra de Luta</h4>
			</div>
			<div class="modal-body">

				<div id="conteudo-carrossel" class="container">
					<div class="row-fluid">
						<!--                        <div class="span6 offset3">-->
						<div id="myCarousel" class="carousel slide vertical">
							<!-- Carousel items -->
							<div class="carousel-inner">
                                    <?php $graduacao = new \Graduacao\Service\GraduacaoService(); ?>
                                    <?php $detalhesRegraLutaService = new \DetalhesRegrasLuta\Service\DetalhesRegrasLutaService(); ?>
                                    <?php $arrRegraLuta = $regraLutaService->fetchAll(); ?>
                                    <?php $linha = 0; ?>
                                    <?php foreach($arrRegraLuta as $valor){ ?>
                                        <?php if(in_array($valor->getId(), $arrayRegrasPreenchidas)) { ?>
	                                        <div class="item<?= $linha == 0 ? ' active' : ''?>">
												<table class="table table-bordered dataTable">
													<thead>
														<tr>
															<th>Nome da Regra</th>
															<th>Gradua√ßao Inicial</th>
															<th>Gradua√ßao Final</th>
														</tr>
													</thead>
													<tbody>
		                                            	<?php $linha++; ?>
		                                                <?php $arrDetalhesRegrasLuta = $detalhesRegraLutaService->pegarRegrasDeGraduacaoModalToArray($valor->getId()); ?>
		                                                <td rowspan="<?= count($arrDetalhesRegrasLuta) + 1 ?>" valign="center"><?= $valor->getNmRegraLuta(); ?></td>
		                                                <?php foreach($arrDetalhesRegrasLuta as $regra) { ?>
		                                                   <tr>
		                                                      <td align="center">
		                                                      	<img alt="<?=$regra['nm_graduacao_inicial']?>" height="30" width="30" 
		                                                      	src="/assets/img/graduacoes/<?=$regra['nm_graduacao_inicial']?>.jpeg" />
		                                                      	<br /><?=$regra['nm_graduacao_inicial']?>
		                                                      </td>
		                                                      <td align="center">
			                                                      <img alt="<?=$regra['nm_graduacao_final']?>" height="30" width="30" 
			                                                      src="/assets/img/graduacoes/<?=$regra['nm_graduacao_final']?>.jpeg" />
			                                                      <br /><?=$regra['nm_graduacao_final']?>
		                                                      </td>
		                                                  	</tr>
		                                                <?php } ?>
		                                           </tbody>
												</table>
											</div>
                                        <?php } ?>
                                    <?php } ?>
                                </div>
							<!-- Carousel nav -->
							<a class="carousel-control left" href="#myCarousel"
								data-slide="prev"> ‚Äπ </a> <a class="carousel-control right"
								href="#myCarousel" data-slide="next"> ‚Ä∫ </a>
							<!--                            </div>-->
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
			</div>
		</div>
	</div>
</div>

<script src="/assets/compact-js/moment.js,validator.min.js,jquery.mask.min.js,jquery.ui.widget.js,jquery.tablesorter.js,jquery.tablesorter.widgets.js,jquery.tablesorter.pager.js" type="text/javascript"></script>    
<script type="text/javascript" language="javascript" >
    $(function () {

        // NOTE: $.tablesorter.theme.bootstrap is ALREADY INCLUDED in the jquery.tablesorter.widgets.js
        // file; it is included here to show how you can modify the default classes
        $.tablesorter.themes.bootstrap = {
            // these classes are added to the table. To see other table classes available,
            // look here: http://getbootstrap.com/css/#tables
            table: 'table table-bordered',
            caption: 'caption',
            header: 'bootstrap-header', // give the header a gradient background
            footerRow: '',
            footerCells: '',
            icons: '', // add "icon-white" to make them white; this icon class is added to the <i> in the header
            sortNone: 'bootstrap-icon-unsorted',
            sortAsc: 'icon-chevron-up glyphicon glyphicon-chevron-up', // includes classes for Bootstrap v2 & v3
            sortDesc: 'icon-chevron-down glyphicon glyphicon-chevron-down', // includes classes for Bootstrap v2 & v3
            active: '', // applied when column is sorted
            hover: '', // use custom css here - bootstrap class may not override it
            filterRow: '', // filter row class
            even: '', // odd row zebra striping
            odd: ''  // even row zebra striping
        };

        // call the tablesorter plugin and apply the uitheme widget
        $("#tablesorterEventos").tablesorter({
            // this will apply the bootstrap theme if "uitheme" widget is included
            // the widgetOptions.uitheme is no longer required to be set
            theme: "bootstrap",
            widthFixed: true,
            headerTemplate: '{content} {icon}', // new in v2.7. Needed to add the bootstrap icon!

            // widget code contained in the jquery.tablesorter.widgets.js file
            // use the zebra stripe widget if you plan on hiding any rows (filter widget)
            widgets: ["uitheme", "zebra"],
            widgetOptions: {
                // using the default zebra striping class name, so it actually isn't included in the theme variable above
                // this is ONLY needed for bootstrap theming if you are using the filter widget, because rows are hidden
                zebra: ["even", "odd"],
                // reset filters button
                filter_reset: ".reset"

                        // set the uitheme widget to use the bootstrap theme class names
                        // this is no longer required, if theme is set
                        // ,uitheme : "bootstrap"

            },
            headers: {
                5: {sorter: false}
            }
        });
    });
</script>